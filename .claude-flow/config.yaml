# Claude Flow V3 Runtime Configuration
# PostgreSQL + RuVector Backend
# Generated: 2026-02-09

version: "3.0.0"

# Swarm Configuration (Dynamic Composition)
swarm:
  topology: adaptive               # Dynamic topology switching
  maxAgents: 15
  autoScale: true
  coordinationStrategy: raft
  strategy: dynamic                # Dynamic worker type selection

  # Adaptive Worker Composition
  composition:
    mode: dynamic                  # static | dynamic | hybrid
    autoDetect: true              # Auto-detect required worker types
    rebalanceInterval: 30000      # Rebalance every 30s
    minWorkers: 2
    maxWorkers: 15

  # Worker Type Pools
  workerPools:
    development:
      types: [coder, reviewer, tester, researcher]
      maxConcurrent: 8
      priority: high

    architecture:
      types: [system-architect, v3-integration-architect, v3-security-architect]
      maxConcurrent: 3
      priority: high

    security:
      types: [security-auditor, v3-security-architect, security-manager]
      maxConcurrent: 4
      priority: critical

    performance:
      types: [perf-analyzer, performance-engineer, performance-benchmarker]
      maxConcurrent: 3
      priority: normal

    coordination:
      types: [hierarchical-coordinator, mesh-coordinator, task-orchestrator]
      maxConcurrent: 2
      priority: high

    specialized:
      types: [ml-developer, backend-dev, mobile-dev, api-docs]
      maxConcurrent: 4
      priority: normal

# Memory Configuration (PostgreSQL + RuVector)
memory:
  backend: postgresql
  enableHNSW: true
  persistPath: .claude-flow/data
  cacheSize: 512               # Balanced cache size

  # PostgreSQL Connection Settings
  postgresql:
    # Operating Mode: single-node | patroni-ha
    mode: single-node

    # Single-Node Configuration
    singleNode:
      # Project Database
      project:
        host: localhost
        port: 5432
        database: distributed_postgres_cluster
        user: dpg_cluster
        password: ${DPG_CLUSTER_PASSWORD}  # Use environment variable
        namespace: distributed-postgres-cluster
        poolSize: 40                        # Increased from 25 (4x from original 10)
        maxRetries: 3
        connectionTimeout: 5000

      # Shared Knowledge Database
      shared:
        host: localhost
        port: 5432
        database: claude_flow_shared
        user: shared_user
        password: ${SHARED_DB_PASSWORD}     # Use environment variable
        namespace: claude-flow-v3-learnings
        poolSize: 15                        # Increased from 10 (3x from original 5)
        maxRetries: 3
        connectionTimeout: 5000

    # Patroni HA Configuration
    patroni:
      enabled: false
      # Patroni REST API endpoints
      apiHosts:
        - localhost
      apiPort: 8008
      # Database credentials
      database: distributed_postgres_cluster
      user: dpg_cluster
      password: ${PATRONI_PASSWORD}
      # Connection pool settings
      minConnections: 2
      maxConnections: 20
      # Health check settings
      healthCheckInterval: 30
      apiTimeout: 5
      # Failover settings
      failoverTimeout: 30
      maxRetryAttempts: 3

  # HNSW Configuration (4x Accuracy - High Memory)
  hnsw:
    enabled: true
    m: 64                # 4x from original 16 (dense graph, high memory)
    efConstruction: 800  # 4x from original 200 (maximum build quality)
    efSearch: 800        # 4x from original 200 (maximum search accuracy)

  # Embeddings
  embeddings:
    model: all-MiniLM-L6-v2
    dimensions: 384
    provider: onnx
    cacheEnabled: true

  # ADR-049: Self-Learning Memory (2x Accuracy)
  learningBridge:
    enabled: true
    sonaMode: balanced
    confidenceDecayRate: 0.0025   # Halved from 0.005 (slower decay)
    accessBoostAmount: 0.06        # Doubled from 0.03 (stronger boost)
    consolidationThreshold: 10

  # Memory Graph (High Memory Configuration)
  memoryGraph:
    enabled: true
    pageRankDamping: 0.85
    maxNodes: 50000              # 5x from 10,000 (larger graph capacity)
    similarityThreshold: 0.85    # Increased from 0.7 (stricter matching)

  # Agent Scopes
  agentScopes:
    enabled: true
    defaultScope: project

# Neural Configuration
neural:
  enabled: true
  modelPath: .claude-flow/neural

  # SONA (Self-Optimizing Neural Architecture)
  sona:
    enabled: true
    learningRate: 0.001
    adaptationThreshold: 0.05

  # Mixture of Experts
  moe:
    enabled: true
    numExperts: 8

  # Elastic Weight Consolidation
  ewc:
    enabled: true
    lambda: 0.4

# Hooks Configuration
hooks:
  enabled: true
  autoExecute: true

# MCP Server
mcp:
  autoStart: false
  port: 3000
  host: localhost
  transport: stdio

# Daemon Configuration
daemon:
  autoStart: true
  maxConcurrent: 2
  workerTimeoutMs: 300000

  workers:
    map:
      enabled: true
      intervalMs: 900000
      priority: normal
    audit:
      enabled: true
      intervalMs: 600000
      priority: critical
    optimize:
      enabled: true
      intervalMs: 900000
      priority: high
    consolidate:
      enabled: true
      intervalMs: 1800000
      priority: low
    testgaps:
      enabled: true
      intervalMs: 1200000
      priority: normal
    predict:
      enabled: false
      intervalMs: 600000
      priority: low
    document:
      enabled: false
      intervalMs: 3600000
      priority: low

# Performance Targets
performance:
  targetLatency:
    vectorSearch: 50
    memoryRetrieval: 5
    embeddingGeneration: 10
