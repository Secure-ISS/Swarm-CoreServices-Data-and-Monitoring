[databases]
distributed_postgres_cluster = host=pg-coordinator port=5432 dbname=distributed_postgres_cluster
* = host=pg-coordinator port=5432

[pgbouncer]
listen_addr = *
listen_port = 6432
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

# Connection pooling mode
# transaction - recommended for most cases
# session - required for some applications
# statement - most aggressive pooling
pool_mode = transaction

# Connection limits
max_client_conn = 1000
default_pool_size = 25
min_pool_size = 10
reserve_pool_size = 5

# Timeouts
server_idle_timeout = 600
server_lifetime = 3600
server_connect_timeout = 15
query_timeout = 300
query_wait_timeout = 120

# Connection reuse
server_reset_query = DISCARD ALL
server_reset_query_always = 0

# TLS/SSL (optional - configure if needed)
;client_tls_sslmode = prefer
;client_tls_cert_file = /etc/pgbouncer/client.crt
;client_tls_key_file = /etc/pgbouncer/client.key
;server_tls_sslmode = prefer

# Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
stats_period = 60

# Admin
admin_users = dpg_cluster
stats_users = dpg_cluster

# Performance
max_packet_size = 2147483647
pkt_buf = 4096
sbuf_loopcnt = 5

# DNS
dns_max_ttl = 15
dns_zone_check_period = 0

# Application name support
application_name_add_host = 1

# Autodb
;autodb_idle_timeout = 3600

# Connection pooling tuning
server_check_delay = 30
server_check_query = SELECT 1
server_fast_close = 0

# Verbose logging (disable in production)
verbose = 0
